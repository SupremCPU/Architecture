package Interface;

import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.util.Observable;
import java.util.Observer;

import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;
import javax.swing.border.TitledBorder;
import javax.swing.filechooser.FileNameExtensionFilter;

import hardware.FileScan;
import hardware.IO_controller;


public class FileDevicePanel extends JPanel implements Observer{

	
	private int devid;
	
	private FileScan FileScan;
	
	private JTextField fileLocation;
	private JButton changeBtn;
	private JButton resetBtn;
	
	private JLabel availableLabel;
	private JLabel availableTitle;
	
	/**
	 * 
	 */
	private static final long serialVersionUID = 8109231785169972365L;

	
	public FileDevicePanel(int devId){
		
		this.devid = devId;
		FileScan = IO_controller.getInstance().getFileScan(devid);
		FileScan.addObserver(this);
		
		
		TitledBorder nameTitle =new TitledBorder("File IO (DevID:"+devid+",Type:"+(FileScan.isInputFile()?"INPUT":"OUTPUT")+")"); 	
		this.setBorder(nameTitle);
		
		this.setLayout(new GridLayout(2,1,0,0));
		
		fileLocation = new JTextField(FileScan.getFile().getPath());
		
		
		
		this.add(fileLocation);
		
		changeBtn = new JButton("Change");
		changeBtn.setPreferredSize(new Dimension(80,30));
		resetBtn = new JButton("Reset");
		resetBtn.setPreferredSize(new Dimension(70,30));
		
		JPanel btns = new JPanel();
		btns.setLayout(new FlowLayout(FlowLayout.RIGHT,0,0));
		
		if(FileScan.isInputFile()){
			availableTitle = new JLabel("Available Words:");
			btns.add(availableTitle);
			availableLabel = new JLabel(String.valueOf(FileScan.getAvailableSize()));
			btns.add(availableLabel);
		}
		
		
		
		
		btns.add(changeBtn);
		btns.add(resetBtn);
		
		
		this.add(btns);
		
		
		
		addEventListener();
	}
	
	
	private void addEventListener() {
		
		changeBtn.addActionListener(
				new ActionListener(){

					@Override
					public void actionPerformed(ActionEvent e) {
						JFileChooser fileChooser = new JFileChooser(FileScan.getFile());
						FileNameExtensionFilter ff = new FileNameExtensionFilter( ".txt(as io device source)", "txt");  
						fileChooser.setFileFilter(ff);
						int option = fileChooser.showOpenDialog(null);
						
						if(option == JFileChooser.APPROVE_OPTION){
							File file = fileChooser.getSelectedFile();
							FileScan.setFile(file);
							fileLocation.setText(file.getPath());
							//System.out.println(file.getAbsolutePath());
						}
						
					}
					
				});
		
		resetBtn.addActionListener(
				new ActionListener(){

					@Override
					public void actionPerformed(ActionEvent e) {

						try {
							FileScan.reset();;
							//fileLocation.setText(file.getPath());
							if(FileScan.isInputFile())
								availableLabel.setText(String.valueOf(FileScan.getAvailableSize()));
						} catch (Exception e1) {
							// TODO Auto-generated catch block
							e1.printStackTrace();
						}
						
					}
					
				});
		
	}


	@Override
	public void update(Observable o, Object arg) {
		if(FileScan.isInputFile()){
			availableLabel.setText(String.valueOf(FileScan.getAvailableSize()));
		}
	}


}
