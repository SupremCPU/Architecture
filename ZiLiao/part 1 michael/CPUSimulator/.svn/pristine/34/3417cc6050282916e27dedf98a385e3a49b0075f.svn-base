package edu.gwu.core;

import java.util.StringTokenizer;

import edu.gwu.common.Util;
import edu.gwu.core.basic.InstructionSet;

public class ProgramDecoder {

	/**
	 * decode the language code into binary code
	 * @param ins
	 * @return
	 */
	public static int[] decodeInstruction(String ins){
		try {
			StringTokenizer tokenizer = new StringTokenizer(ins," ,");
			
			//while(tokenizer.hasMoreElements()){
			//	System.out.println(tokenizer.nextToken());
			//}
			
			
			
			//OPCODE
			int opcodeValue = InstructionSet.getCodeOfInstruction(tokenizer.nextToken());
			int[]ops = Util.getBitsFromIntValue(opcodeValue, 6);
			//R
			int rValue = Integer.parseInt(tokenizer.nextToken());
			int[] rs = Util.getBitsFromIntValue(rValue, 2);
			//IX
			int ixValue = Integer.parseInt(tokenizer.nextToken());
			int[] ixs = Util.getBitsFromIntValue(ixValue, 2);
			//I
			int iValue = Integer.parseInt(tokenizer.nextToken());
			int[] is = Util.getBitsFromIntValue(iValue, 1);
			//ADDR
			int addrValue = Integer.parseInt(tokenizer.nextToken());
			int[] addrs = Util.getBitsFromIntValue(addrValue, 7);
			
			int[]result = new int[18];
			for(int i=0;i<ops.length;i++)
				result[i] = ops[i];
			for(int i=0;i<ixs.length;i++)
				result[i+6] = ixs[i];
			for(int i=0;i<rs.length;i++)
				result[i+8] = rs[i];
			for(int i=0;i<is.length;i++)
				result[i+10] = is[i];
			for(int i=0;i<addrs.length;i++)
				result[i+11] = addrs[i];
			
			
			return result;
		} catch (Exception e) {
			//e.printStackTrace();
			return null;
		}
	}
	
}
